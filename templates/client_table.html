{% extends "layout.html" %} {% block title %}Ügyfelek - Jogügyleti
Nyilvántartó{% endblock %} {% block content %}
<style>
  .table td,
  .table th {
    max-width: 200px;
    white-space: normal;
    overflow-wrap: break-word;
  }
  .table td,
  .table th {
    max-width: 200px;
    white-space: normal;
    overflow-wrap: break-word;
  }
  .modal-content {
    background-color: #1f1f1f;
    color: #ffffff;
  }
  .modal-header,
  .modal-footer {
    border-color: rgba(255, 255, 255, 0.1);
  }
  th.sortable {
    cursor: pointer;
    user-select: none;
  }
  th.sortable::after {
    content: ' ⇅';
    font-size: 0.8em;
    color: #888;
  }
</style>

{% if clients is not defined %}
<p>Betöltés...</p>
{% elif clients|length == 0 %}
<p>Nincs még rögzített ügyfél.</p>
{% else %}
<h1 class="mb-4">Rögzített bedolgozható cégek</h1>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-4">
        <input
          type="text"
          id="tableSearch"
          class="form-control"
          placeholder="Keresés..."
        />
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-light">
          <tr>
            <th class="sortable" data-type="number">ID</th>
            <th class="sortable" data-type="string">Kód</th>
            <th class="sortable" data-type="string">Név</th>
            <th class="sortable" data-type="string">Adószám</th>
            <th class="sortable" data-type="string">Típus</th>
            <th class="sortable" data-type="date">Születési dátum</th>
            <th class="sortable" data-type="string">Cím / Székhely</th>
            <th>Műveletek</th>
          </tr>
        </thead>
        <tbody>
          {% for client in clients %}
          <tr>
            <td>{{ client.id }}</td>
            <td>{{ client.client_code }}</td>
            <td>{{ client.name }}</td>
            <td>{{ client.tax_number or '' }}</td>
            <td>
              {% if client.client_type == 'PERSON' %} Személy {% elif
              client.client_type == 'COMPANY' %} Cég {% else %} {{
              client.client_type }} {% endif %}
            </td>
            <td>
              {% if client.client_type == 'PERSON' %} {{ client.birth_date or ''
              }} {% else %} - {% endif %}
            </td>
            <td>
              {% if client.client_type == 'PERSON' %} {{ client.address or '' }}
              {% elif client.client_type == 'COMPANY' %} {{ client.headquarters
              or '' }} {% else %} - {% endif %}
            </td>
            <td class="text-nowrap">
              <a
                href="/edit-client/{{ client.id }}"
                class="btn btn-sm btn-outline-primary"
                title="Szerkesztés"
              >
                <i class="fa-solid fa-pen"></i>
              </a>
              <a
                href="#"
                class="btn btn-sm btn-outline-danger"
                title="Törlés"
                data-bs-toggle="modal"
                data-bs-target="#deleteClientModal"
                data-client-id="{{ client.id }}"
              >
                <i class="fa-solid fa-trash"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div
        class="modal fade"
        id="deleteOutsourceCompanyModal"
        tabindex="-1"
        aria-labelledby="deleteOutsourceCompanyModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteClientModalLabel">
                Ügyfél törlése
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Bezárás"
              ></button>
            </div>
            <div class="modal-body">
              <p class="mb-0">
                Biztosan törlöd ezt az ügyfélét?<br />
                <strong>Ez a művelet nem vonható vissza.</strong>
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Mégse
              </button>
              <form id="deleteForm" method="POST">
                <button type="submit" class="btn btn-danger">Törlés</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
<script src="/static/js/table_sort_search.js"></script>
<script>
  const deleteForm = document.getElementById('deleteForm');
  const deleteModal = document.getElementById('deleteClientModal');

  deleteModal.addEventListener('show.bs.modal', function (event) {
    const triggerBtn = event.relatedTarget;
    const clientId = triggerBtn.getAttribute('data-client-id');

    deleteForm.method = 'POST';
    deleteForm.action = `/delete-client/${clientId}`;
  });
</script>
{% endblock %}
